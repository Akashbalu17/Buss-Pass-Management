<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bus Ticket</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <style>
    :root {
      --ticket-primary: #0d6efd;
      --ticket-secondary: #0b4db3;
      --ticket-accent: #17a2ff;
      --ticket-bg: #f2f7ff;
      --ticket-border: #d6e7ff;
    }
    body {
      background:
        radial-gradient(circle at 15% 20%, #d8eaff 0%, transparent 42%),
        radial-gradient(circle at 90% 85%, #e8dcff 0%, transparent 30%),
        linear-gradient(135deg, #eef5ff 0%, #f8fbff 55%, #edf3ff 100%);
      min-height: 100vh;
    }
    .ticket-shell { max-width: 980px; margin: 2rem auto; }
    .ticket-header {
      background:
        linear-gradient(135deg, var(--ticket-primary) 0%, var(--ticket-secondary) 100%);
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    .ticket-header::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 78% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 38%);
      pointer-events: none;
    }
    .ticket-card {
      border-radius: 1rem;
      border: 1px solid var(--ticket-border);
      overflow: hidden;
      box-shadow: 0 18px 48px rgba(13, 58, 127, 0.14);
    }
    .ticket-photo { width: 140px; height: 170px; object-fit: cover; border: 3px solid var(--ticket-primary); border-radius: 10px; }
    .info-chip {
      border-radius: 0.7rem;
      border: 1px solid var(--ticket-border);
      padding: 0.7rem 0.8rem;
      background: #fff;
      height: 100%;
    }
    .verify-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 0.6rem;
    }
    .verify-day {
      background: #ffffff;
      border: 1px solid #d7e6ff;
      border-radius: 0.55rem;
      padding: 0.45rem 0.5rem;
      font-size: 0.8rem;
    }
    .verify-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.35rem;
      margin-top: 0.25rem;
      color: #355273;
      font-size: 0.72rem;
    }
    .verify-box {
      width: 13px;
      height: 13px;
      border: 1px solid #6c757d;
      border-radius: 2px;
      flex-shrink: 0;
      background: #fff;
    }
    .meta-label {
      color: #4f6b8d;
      font-size: 0.74rem;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.4px;
    }
    .meta-value { font-weight: 700; color: #112945; }
    .label-icon { margin-right: 0.35rem; font-size: 0.82rem; vertical-align: -1px; }
    .ico-name { color: #0ea5e9; }
    .ico-id { color: #f59e0b; }
    .ico-inst { color: #22c55e; }
    .ico-type { color: #14b8a6; }
    .ico-route { color: #2563eb; }
    .ico-money { color: #10b981; }
    .ico-valid { color: #8b5cf6; }
    .ico-issue { color: #0284c7; }
    .ico-exp { color: #ef4444; }
    @media print {
      .no-print { display: none !important; }
      body { background: #fff; }
      .ticket-shell { margin: 0; max-width: 100%; }
      .card { border: 0 !important; box-shadow: none !important; }
    }
  </style>
</head>
<body>
  <div class="container ticket-shell">
    <div class="text-center mb-4">
      <h1 class="h3 fw-bold mb-1 text-primary">Digital Student Travel Ticket</h1>
      <p class="text-muted mb-0">Tamil Nadu State Transport Corporation</p>
    </div>

    <div class="card ticket-card">
      <div class="card-header ticket-header py-3">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
          <div>
            <h2 class="h5 mb-1">Travel Ticket</h2>
            <div class="small">Application No: <strong><%= appData.applicationNo %></strong></div>
          </div>
          <span class="badge bg-light text-primary fs-6">Approved</span>
        </div>
      </div>
      <div class="card-body p-4">
        <div class="row g-4">
          <div class="col-md-3 text-center">
            <img src="/<%= appData.studentPhoto %>" alt="Student Photo" class="ticket-photo" onerror="this.src='https://via.placeholder.com/140x170?text=Photo'" />
            <div class="mt-2 small text-muted">Ticket ID</div>
            <div class="fw-bold"><%= appData.ticketNumber || "-" %></div>
            <span class="badge rounded-pill text-bg-primary mt-2 px-3 py-2">Month Pass</span>
          </div>
          <div class="col-md-9">
            <div class="row g-3">
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-person-fill label-icon ico-name"></i>Student Name</div><div class="meta-value"><%= appData.studentName || "-" %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-person-vcard-fill label-icon ico-id"></i>Bus Pass ID</div><div class="meta-value"><%= appData.idNumber || "-" %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-building-fill label-icon ico-inst"></i>Institution</div><div class="meta-value"><%= institutionName %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-diagram-3-fill label-icon ico-type"></i>Type</div><div class="meta-value"><%= appData.institutionType || "-" %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-geo-alt-fill label-icon ico-route"></i>Route From</div><div class="meta-value"><%= appData.startRoute || "-" %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-flag-fill label-icon ico-route"></i>Route To</div><div class="meta-value"><%= appData.endRoute || "-" %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-cash-coin label-icon ico-money"></i>Monthly Amount</div><div class="meta-value">Rs <%= ticketAmount %></div></div></div>
              <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-calendar-range-fill label-icon ico-valid"></i>Validity</div><div class="meta-value"><%= monthLabel %> (1-<%= lastDay %>)</div></div></div>
            </div>
          </div>
        </div>
        <hr class="my-4" />
        <div class="row g-3">
          <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-calendar-check-fill label-icon ico-issue"></i>Issue Date</div><div class="meta-value"><%= issueDate %></div></div></div>
          <div class="col-md-6"><div class="info-chip"><div class="meta-label"><i class="bi bi-calendar-x-fill label-icon ico-exp"></i>Expiry Date</div><div class="meta-value"><%= expiryDate %></div></div></div>
        </div>
        <div class="mt-4 border rounded-3 p-3" style="background: var(--ticket-bg); border-color: var(--ticket-border) !important;">
          <div class="fw-semibold mb-2 text-primary">Conductor Verification (Tick by date, Morning/Evening):</div>
          <div class="verify-grid">
            <% days.forEach((day) => { %>
              <div class="verify-day">
                <div class="fw-semibold text-primary"><%= day %></div>
                <div class="verify-row"><span>M</span><span class="verify-box"></span></div>
                <div class="verify-row"><span>E</span><span class="verify-box"></span></div>
              </div>
            <% }); %>
          </div>
          <div class="mt-3 pt-2 border-top">
            <small class="text-muted">Verified by Conductor (Name/Sign): ____________________________</small>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex flex-wrap gap-2 justify-content-center mt-3 no-print">
      <button class="btn btn-primary" onclick="window.print()">Print Ticket</button>
      <a class="btn btn-outline-primary" href="/ticket/download/<%= encodeURIComponent(appData.applicationNo) %>">Download Ticket PDF</a>
      <a class="btn btn-secondary" href="/status">Back to Status</a>
    </div>
  </div>
</body>
</html>
